<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="offline_web_proxy API docs, for the Dart programming language.">
  <title>offline_web_proxy - Dart API docs</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="static-assets/github.css?v1">
  <link rel="stylesheet" href="static-assets/styles.css?v1">
  <link rel="icon" href="static-assets/favicon.png?v1">

  
</head>


<body data-base-href="" data-using-base-href="false" class="light-theme">

<div id="overlay-under-drawer"></div>

<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="https://github.com/meibinlab/offline_web_proxy">offline_web_proxy package</a></li>
  </ol>
  <div class="self-name">offline_web_proxy</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <div class="toggle" id="theme-button" title="Toggle brightness">
    <label for="theme">
      <input type="checkbox" id="theme" value="light-theme">
      <span id="dark-theme-button" class="material-symbols-outlined">
        dark_mode
      </span>
      <span id="light-theme-button" class="material-symbols-outlined">
        light_mode
      </span>
    </label>
  </div>
</header>
<main>

  <div id="dartdoc-main-content" class="main-content">
      
<section class="desc markdown">
  <h1 id="offline_web_proxy">offline_web_proxy</h1>
<p><a href="https://github.com/meibinlab/offline_web_proxy/actions/workflows/ci.yml"><img src="https://github.com/meibinlab/offline_web_proxy/actions/workflows/ci.yml/badge.svg" alt="CI/CD Pipeline"></a>
<a href="https://pub.dev/packages/offline_web_proxy"><img src="https://img.shields.io/pub/v/offline_web_proxy.svg" alt="Pub Version"></a>
<a href="LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License"></a>
<a href="https://codecov.io/gh/meibinlab/offline_web_proxy"><img src="https://codecov.io/gh/meibinlab/offline_web_proxy/branch/main/graph/badge.svg" alt="Coverage"></a></p>
<p>An offline-compatible local proxy server that operates within Flutter WebView. It aims to enable existing web systems to function seamlessly in mobile apps without requiring awareness of online/offline states.</p>
<h2 id="features">Features</h2>
<h3 id="core-functions">Core Functions</h3>
<ul>
<li>Intercepts HTTP requests from WebView through a local proxy server</li>
<li>Forwards requests to upstream server when online, serves responses from cache when offline</li>
<li>Queues update requests (POST/PUT/DELETE) when offline</li>
<li>Automatically sends queued requests upon online recovery for seamless offline support</li>
<li>Local serving of static resources</li>
</ul>
<h3 id="offline-support">Offline Support</h3>
<ul>
<li>Combines RFC-compliant cache control with offline compatibility</li>
<li>Intelligent cache management based on Cache-Control and Expires headers</li>
<li>Ignores no-cache directives and uses stale cache when offline</li>
<li>Prevents duplicate execution through idempotency guarantees</li>
</ul>
<h3 id="queuing-system">Queuing System</h3>
<ul>
<li>Guarantees request order through FIFO (First In, First Out)</li>
<li>Automatic retry with exponential backoff</li>
<li>Persistence for continued processing after restarts</li>
</ul>
<h3 id="cookie-management">Cookie Management</h3>
<ul>
<li>RFC-compliant cookie evaluation and management</li>
<li>AES-256 encrypted persistence</li>
<li>High-speed access through memory caching</li>
</ul>
<h2 id="installation">Installation</h2>
<p>Add the following to your <code>pubspec.yaml</code>:</p>
<pre class="language-yaml"><code class="language-yaml">dependencies:
  offline_web_proxy: ^0.2.2
  # Add the following if using WebView
  # webview_flutter: ^4.4.2
</code></pre>
<h2 id="usage">Usage</h2>
<h3 id="basic-setup">Basic Setup</h3>
<pre class="language-dart"><code class="language-dart">import 'package:offline_web_proxy/offline_web_proxy.dart';
// Note: Add the following dependency if using WebView
// import 'package:webview_flutter/webview_flutter.dart';

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() =&gt; _MyAppState();
}

class _MyAppState extends State&lt;MyApp&gt; {
  late OfflineWebProxy proxy;
  int? proxyPort;
  
  @override
  void initState() {
    super.initState();
    _startProxy();
  }
  
  Future&lt;void&gt; _startProxy() async {
    proxy = OfflineWebProxy();
    
    // Configuration object (optional)
    final config = ProxyConfig(
      origin: 'https://api.example.com', // Upstream server URL
      cacheMaxSize: 200 * 1024 * 1024,   // Maximum cache size (200MB)
    );
    
    // Start proxy server
    proxyPort = await proxy.start(config: config);
    print('Proxy server started: http://127.0.0.1:$proxyPort');
    
    setState(() {});
  }
  
  @override
  void dispose() {
    proxy.stop();
    super.dispose();
  }
  
  @override
  Widget build(BuildContext context) {
    if (proxyPort == null) {
      return Scaffold(
        body: Center(child: CircularProgressIndicator()),
      );
    }
    
    return Scaffold(
      appBar: AppBar(title: Text('Offline-Ready WebView')),
      body: WebView(
        initialUrl: 'http://127.0.0.1:$proxyPort/app',
        javascriptMode: JavascriptMode.unrestricted,
      ), // Note: webview_flutter dependency required
    );
  }
}
</code></pre>
<h3 id="advanced-configuration-with-configuration-file">Advanced Configuration with Configuration File</h3>
<p>Create <code>assets/config/config.yaml</code> for detailed configuration:</p>
<pre class="language-yaml"><code class="language-yaml">proxy:
  server:
    origin: "https://api.example.com"
    
  cache:
    maxSizeBytes: 209715200 # 200MB
    ttl:
      "text/html": 3600      # HTML: 1 hour
      "text/css": 86400      # CSS: 24 hours
      "image/*": 604800      # Images: 7 days
      "default": 86400       # Others: 24 hours
    
    # Startup cache update
    startup:
      enabled: true
      paths:
        - "/config"
        - "/user/profile"
        - "/assets/app.css"
      
  queue:
    drainIntervalSeconds: 3  # Queue processing interval
    retryBackoffSeconds: [1, 2, 5, 10, 20, 30] # Retry intervals
    
  timeouts:
    connect: 10   # Connection timeout
    request: 60   # Request timeout
</code></pre>
<h3 id="static-resource-serving">Static Resource Serving</h3>
<p>Place files in the app's <code>assets/static/</code> folder for local serving:</p>
<pre class="language-dart"><code>assets/
├── static/
│   ├── app.css      # Served at http://127.0.0.1:port/app.css
│   ├── app.js       # Served at http://127.0.0.1:port/app.js
│   └── images/
│       └── logo.png # Served at http://127.0.0.1:port/images/logo.png
└── config/
    └── config.yaml
</code></pre>
<h3 id="cache-management">Cache Management</h3>
<pre class="language-dart"><code class="language-dart">// Clear all cache
await proxy.clearCache();

// Clear only expired cache
await proxy.clearExpiredCache();

// Clear cache for specific URL
await proxy.clearCacheForUrl('https://api.example.com/data');

// Get cache statistics
final stats = await proxy.getCacheStats();
print('Cache hit rate: ${stats.hitRate}%');

// Get cache list
final cacheList = await proxy.getCacheList();
for (final entry in cacheList) {
  print('URL: ${entry.url}, Status: ${entry.status}');
}

// Pre-warm cache
final result = await proxy.warmupCache(
  paths: ['/config', '/user/profile'],
  onProgress: (completed, total) {
    print('Progress: $completed/$total');
  },
);
</code></pre>
<h3 id="cookie-management-2">Cookie Management</h3>
<pre class="language-dart"><code class="language-dart">// Get cookie list (values are masked)
final cookies = await proxy.getCookies();
for (final cookie in cookies) {
  print('${cookie.name}: ${cookie.value} (${cookie.domain})');
}

// Clear all cookies
await proxy.clearCookies();

// Clear cookies for specific domain
await proxy.clearCookies(domain: 'example.com');
</code></pre>
<h3 id="queue-management">Queue Management</h3>
<pre class="language-dart"><code class="language-dart">// Check queued requests
final queued = await proxy.getQueuedRequests();
print('Queued: ${queued.length} requests');

// Get dropped request history
final dropped = await proxy.getDroppedRequests();
for (final request in dropped) {
  print('${request.url}: ${request.dropReason}');
}

// Clear drop history
await proxy.clearDroppedRequests();
</code></pre>
<h3 id="real-time-monitoring">Real-time Monitoring</h3>
<pre class="language-dart"><code class="language-dart">// Monitor proxy events
proxy.events.listen((event) {
  switch (event.type) {
    case ProxyEventType.cacheHit:
      print('Cache hit: ${event.url}');
      break;
    case ProxyEventType.requestQueued:
      print('Queued: ${event.url}');
      break;
    case ProxyEventType.queueDrained:
      print('Queue drained: ${event.url}');
      break;
  }
});

// Get statistics
final stats = await proxy.getStats();
print('Total requests: ${stats.totalRequests}');
print('Cache hit rate: ${stats.cacheHitRate}%');
print('Uptime: ${stats.uptime}');
</code></pre>
<h2 id="architecture">Architecture</h2>
<h3 id="communication-flow">Communication Flow</h3>
<pre class="language-dart"><code>WebView → http://127.0.0.1:&lt;port&gt; → OfflineWebProxy
                                           ↓
                                    [Online Check]
                                           ↓
                              ┌──────────────────────┐
                              │                      │
                         [Online]               [Offline]
                              │                      │
                              ↓                      ↓
                      ┌─────────────┐        ┌─────────────┐
                      │Forward to   │        │Serve from   │
                      │upstream     │        │cache        │
                      └─────────────┘        └─────────────┘
                              │                      │
                              ↓                      ↓
                      ┌─────────────┐        ┌─────────────┐
                      │Save response│        │Queue        │
                      │to cache     │        │POST/PUT/    │
                      └─────────────┘        │DELETE       │
                                             └─────────────┘
</code></pre>
<h3 id="cache-strategy">Cache Strategy</h3>
<ol>
<li><strong>Fresh</strong>: Within TTL → Use directly</li>
<li><strong>Stale</strong>: TTL expired but within stale period
<ul>
<li>Online: Validate with conditional requests</li>
<li>Offline: Use stale cache</li>
</ul>
</li>
<li><strong>Expired</strong>: Stale period also exceeded → Deletion target</li>
</ol>
<h3 id="security">Security</h3>
<ul>
<li><strong>Local Binding</strong>: Bind only to 127.0.0.1 to prevent external access</li>
<li><strong>Cookie Encryption</strong>: Persist cookies with AES-256 encryption</li>
<li><strong>Path Traversal Prevention</strong>: Restrict access to <code>assets/static/</code> subdirectory</li>
<li><strong>Log Masking</strong>: Mask sensitive information like Authorization and Cookie headers</li>
</ul>
<h2 id="platform-support">Platform Support</h2>
<h3 id="ios-configuration">iOS Configuration</h3>
<p>Add ATS exception to <code>ios/Runner/Info.plist</code>:</p>
<pre class="language-xml"><code class="language-xml">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;NSAllowsLocalNetworking&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
</code></pre>
<h3 id="android-configuration">Android Configuration</h3>
<p>Create <code>android/app/src/main/res/xml/network_security_config.xml</code>:</p>
<pre class="language-xml"><code class="language-xml">&lt;network-security-config&gt;
    &lt;domain-config cleartextTrafficPermitted="true"&gt;
        &lt;domain includeSubdomains="false"&gt;127.0.0.1&lt;/domain&gt;
    &lt;/domain-config&gt;
&lt;/network-security-config&gt;
</code></pre>
<p>Add to <code>android/app/src/main/AndroidManifest.xml</code>:</p>
<pre class="language-xml"><code class="language-xml">&lt;application
    android:networkSecurityConfig="@xml/network_security_config"&gt;
</code></pre>
<h2 id="license">License</h2>
<p>MIT License</p>
<h2 id="dependencies">Dependencies</h2>
<p>This plugin uses the following packages:</p>
<ul>
<li><a href="https://pub.dev/packages/shelf">shelf</a> - HTTP server framework</li>
<li><a href="https://pub.dev/packages/shelf_proxy">shelf_proxy</a> - Proxy functionality</li>
<li><a href="https://pub.dev/packages/shelf_router">shelf_router</a> - Routing</li>
<li><a href="https://pub.dev/packages/connectivity_plus">connectivity_plus</a> - Network status monitoring</li>
<li><a href="https://pub.dev/packages/hive">hive</a> - Database (SQLite alternative)</li>
<li><a href="https://pub.dev/packages/path_provider">path_provider</a> - File path access</li>
</ul>
<h2 id="support">Support</h2>
<p>Please report bugs and feature requests to <a href="https://github.com/meibinlab/offline_web_proxy/issues">GitHub Issues</a>.</p>
<h2 id="developer-guide">Developer Guide</h2>
<h3 id="debug-features">Debug Features</h3>
<p>Debug features available during development:</p>
<pre class="language-yaml"><code class="language-yaml">debug:
  enableAdminApi: true        # Enable admin API
  cacheInspection: true       # Cache content inspection
  detailedHeaders: true       # Detailed header information
</code></pre>
<p><strong>Note</strong>: Always set to <code>false</code> in production environments.</p>
<h3 id="log-level">Log Level</h3>
<pre class="language-yaml"><code class="language-yaml">logging:
  level: "debug"                    # debug/info/warn/error
  maskSensitiveHeaders: true        # Mask sensitive information
</code></pre>
<h3 id="performance-monitoring">Performance Monitoring</h3>
<pre class="language-dart"><code class="language-dart">// Periodic statistics collection
Timer.periodic(Duration(minutes: 5), (timer) async {
  final stats = await proxy.getStats();
  print('Cache hit rate: ${stats.cacheHitRate}%');
  print('Queue length: ${stats.queueLength}');
});
</code></pre>
</section>


      <section class="summary">
          <h2>Libraries</h2>
        <dl>
          <dt id="offline_web_proxy">
  <span class="name"><a href="offline_web_proxy/offline_web_proxy-library.html">offline_web_proxy</a></span> 

</dt>
<dd>offline_web_proxy
</dd>

        </dl>
      </section>

  </div> <!-- /.main-content -->

  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="https://github.com/meibinlab/offline_web_proxy">offline_web_proxy package</a></li>
</ol>


    <h5 class="hidden-xs"><span class="package-name">offline_web_proxy</span> <span class="package-kind">package</span></h5>
    <ol>
      <li class="section-title">Libraries</li>
      <li><a href="offline_web_proxy/offline_web_proxy-library.html">offline_web_proxy</a></li>
</ol>

  </div>

  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div>

</main>

<footer>
  <span class="no-break">
    offline_web_proxy
      0.2.2
  </span>

  
</footer>



<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/docs.dart.js"></script>



</body>

</html>

